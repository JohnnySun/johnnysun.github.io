---
title: Rxjava简单的源码分析
author: JohnnySun
tags: 'RxJava,Android,Thread'
categories: Android
date: 2018-8-16

---

<p><em>本文对rxjava最常用的方法进行一部分源码解读，便于大家理解rxjava的工作原理</em></p>
<p>下面是一个完整的Rxjava create 调用流程</p>
<p><img src="blob:https://stackedit.io/1f80cb2f-b3dd-4d38-ac39-a7999624338f" alt="Image.png"></p>
<p><strong>这里来看Rxjva如何来做线程切换，以及observeOn和subscribeOn的区别</strong></p>
<p><strong>我们先来看observeOn的</strong></p>
<ul>
<li>observeOn的本质是lift变换</li>
</ul>
<p><img src="blob:https://stackedit.io/6ce31bdc-b2e1-4330-aac2-9e4819d6571a" alt="Image_1.png"></p>
<ul>
<li>lift本质是不考虑背压的unsafeCreate</li>
</ul>
<p><img src="blob:https://stackedit.io/721fa430-056e-48ef-b705-8a600d1c1fc8" alt="Image_2.png"></p>
<ul>
<li>这里来看一下OnSubScribeLift方法实现</li>
</ul>
<p><img src="blob:https://stackedit.io/d11d2f27-eeea-4762-8cb5-801ceb7376a6" alt="Pasted Graphic.tiff"></p>
<h2 id="结论：这里由上面看出，observeon的本质是影响subscribe的调用线程"><strong>结论：这里由上面看出，observeOn的本质是影响Subscribe的调用线程</strong></h2>
<p><strong>我们再来看subscribeOn的</strong><br>
本质上也是个create 也是创建一个OnSubscribe</p>
<p><img src="blob:https://stackedit.io/b97a5490-2f3d-47f4-8bbb-0d51a8328354" alt="Image_3.png"><br>
<img src="blob:https://stackedit.io/26a95143-53cc-4cab-b24e-b41b0372195a" alt="Image_4.png"><br>
来看下OperatorSubscribeOn<br>
<img src="blob:https://stackedit.io/d14e16d1-957c-43ce-a405-e3da6ee95c3c" alt="Image_5.png"><br>
所以 SubscribeOn 和 ObserveOn 切换线程并不是完全像网上所说的那样 SubscribeOn切换前面的方法执行线程 ObserveOn切换后面的方法执行线程<br>
<strong>应该是SubscribeOn切换前面的onSubscribe.call()方法的执行线程</strong></p>
<p><strong>而ObserveOn切换他后面Observe方法中OnNext OnComplete登方法切换的线程</strong></p>
<p><strong>至于为什么ObserveOn能够切换map flat等方法的线程而SubscribeOn不行是因为map float后面的action回调是在他们创建的新的Observeable的subscribe方法中回调回来的而不是在onSubscribe.call中</strong></p>
<hr>
<p>这里是对subscribe的执行方法 他会回调最后一个Observable.java中的onSubscribe的call方法使得rxjava的调用流程就像开始的第一张图那样。</p>
<p><img src="blob:https://stackedit.io/615d25b0-ac3e-459d-b257-cef8be94c646" alt="Pasted Graphic 1.tiff"></p>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

